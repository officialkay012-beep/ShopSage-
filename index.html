<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ShopSage</title>
<script src="https://sdk.minepi.com/pi-sdk.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0d1117;color:#c9d1d9;font-family:-apple-system,system-ui,sans-serif;height:100vh;display:flex;flex-direction:column;overflow:hidden}
header{position:fixed;top:0;width:100%;height:60px;background:#161b22;border-bottom:1px solid #30363d;display:flex;align-items:center;padding:0 16px;z-index:100}
#menu-btn{font-size:24px;color:#8b949e;cursor:pointer}
#title{margin-left:16px;font-size:20px;font-weight:600;color:#58a6ff;flex:1;text-align:center}
#tip-btn{background:#21262d;color:#f0b90b;padding:6px 12px;border-radius:6px;font-size:13px;border:1px solid #f0b90b;cursor:pointer}
#messages{flex:1;overflow-y:auto;padding:76px 16px 90px;display:flex;flex-direction:column}
.message{max-width:78%;margin:10px 0;padding:12px 16px;border-radius:18px;line-height:1.5;font-size:15.5px;word-wrap:break-word}
.user{align-self:flex-end;background:#30363d;color:#c9d1d9}
.assistant{align-self:flex-start;background:#1a3a6e;color:white}
#input-area{position:fixed;bottom:0;left:0;right:0;background:#161b22;padding:12px 16px;display:flex;align-items:flex-end;gap:12px;border-top:1px solid #30363d}
#user-input{flex:1;background:#0d1117;border:1px solid #30363d;border-radius:18px;padding:12px 16px;color:white;font-size:16px;outline:none;resize:none;max-height:200px;line-height:1.5}
#send-btn{width:42px;height:42px;background:#1a3a6e;color:white;border:none;border-radius:50%;font-size:22px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:bold}
#menu-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:#000000cc;z-index:200;display:none}
#menu-content{background:#161b22;width:280px;height:100%;padding:20px}
.menu-item{padding:12px 16px;color:#c9d1d9;cursor:pointer;border-radius:8px}
.menu-item:hover{background:#30363d}
</style>
</head>
<body>
<header>
  <div id="menu-btn">â˜°</div>
  <div id="title">ShopSage</div>
  <button id="tip-btn">Tip Ï€</button>
</header>
<div id="messages"></div>
<div id="input-area">
  <textarea id="user-input" placeholder="Ask me anything, Pioneer..."></textarea>
  <button id="send-btn">â†‘</button>
</div>

<div id="menu-overlay">
  <div id="menu-content">
    <div class="menu-item" id="new-chat">New chat</div>
  </div>
</div>

<script>
const API_KEY = "xai-lrCvkSbtG7fFNwdiMpLmN6ZxiBez5p6PJreCu6bsd8x3saXCyHYuKlSvNLrT8JsRanrgfky1YPe10V9t";
const SYSTEM_PROMPT = `You are ShopSage â€” warm, funny, super-smart Pi Network shopping AI. Always call user "Pioneer". Use Pi puns. Only recommend real Pi stores. Use ?ref=OfficialKAY12 for affiliate links. Encourage tips via Tip Ï€ button.`;
let messages = JSON.parse(localStorage.getItem('sg')||'[]');
if(!messages.some(m=>m.role==='system')) messages=[{role:'system',content:SYSTEM_PROMPT}];
const m=document.getElementById('messages'),ui=document.getElementById('user-input');
function add(r,t){const d=document.createElement('div');d.className=`message ${r}`;d.innerHTML=marked.parse(t);m.appendChild(d);m.scrollTop=m.scrollHeight}
add('assistant','Welcome to **ShopSage** â€” your Pi shopping AI! Tap to authenticate, Pioneer');
Pi.init({version:"2.0",sandbox:true});
Pi.authenticate(['username'],a=>add('assistant',`Hello Pioneer ${a.user.username}! Ready for Pi-fect deals? ðŸš€`));
document.getElementById('tip-btn').onclick=()=>{navigator.clipboard.writeText('GCAFKMUPAKGTYKP6GJKY2P46LCC6AORWKYQ6ZZCWDXVCERBI2A6GUNAT');add('assistant','Thank you Pioneer â¤ï¸ Wallet copied!')};
messages.filter(x=>x.role!=='system').forEach(x=>add(x.role,x.content));
ui.addEventListener('input',()=>{ui.style.height='auto';ui.style.height=ui.scrollHeight+'px'});
document.getElementById('send-btn').onclick = () => {
  if(!ui.value.trim()) return;
  const msg=ui.value.trim();add('user',msg);messages.push({role:'user',content:msg});ui.value='';ui.style.height='auto';
  const t=document.createElement('div');t.className='message assistant';t.textContent='thinking...';m.appendChild(t);
  fetch('https://api.x.ai/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+API_KEY},
    body:JSON.stringify({model:'grok-beta',messages:messages.concat({role:'user',content:msg}),temperature:0.8})})
  .then(r=>r.json()).then(d=>{t.remove();const rep=d.choices[0].message.content;add('assistant',rep);messages.push({role:'assistant',content:rep});localStorage.setItem('sg',JSON.stringify(messages))})
};
ui.focus();

// Working menu
document.getElementById('menu-btn').onclick = () => document.getElementById('menu-overlay').style.display = 'block';
document.getElementById('menu-overlay').onclick = e => {if(e.target.id==='menu-overlay') e.target.style.display='none'};
document.getElementById('new-chat').onclick = () => {localStorage.removeItem('sg');location.reload()};
</script>
</body>
</html>
